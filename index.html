<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>本地视频目录播放器</title>
    <style>
        :root {
            --theme: #00d4aa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* ===== 侧边栏 ===== */
        #sidebar {
            width: 260px;
            flex-shrink: 0;
            background: #222;
            display: flex;
            flex-direction: column;
            transition: width .3s;
            overflow: hidden;
        }

        #sidebar.collapsed {
            width: 0;
        }

        /* 2. 让按钮固定在屏幕左侧，始终可见 */
        #toggleDir {
            position: fixed;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            z-index: 999;
            background: #111;
            color: var(--theme);
            border: none;
            padding: 8px;
            font-size: 20px;
            cursor: pointer;
            border-radius: 0 8px 8px 0;
        }

        /* 3. 当 sidebar 折叠时，把按钮稍微往右推，避免重叠 */
        #sidebar.collapsed+#toggleDir {
            left: 0;
        }

        #videoList {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            list-style: none;
        }

        #videoList li {
            padding: 8px 6px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #videoList li:hover {
            background: #333;
        }

        #videoList li.active {
            background: var(--theme);
            color: #000;
        }

        #dropZone {
            border: 2px dashed #555;
            margin: 10px;
            padding: 20px;
            text-align: center;
            color: #888;
            border-radius: 6px;
        }

        #dropZone.dragover {
            border-color: var(--theme);
            color: var(--theme);
        }

        /* ===== 主内容 ===== */
        #main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        h1 {
            margin-bottom: 20px;
        }

        .video-container {
            position: relative;
            max-width: 900px;
            width: 100%;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
        }

        video {
            width: 100%;
            display: block;
        }

        .controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, #000, transparent);
            padding: 15px;
            opacity: 0;
            transition: opacity .3s;
        }

        .video-container:hover .controls {
            opacity: 1;
        }

        .progress-bar {
            width: 100%;
            height: 5px;
            background: rgba(255, 255, 255, .3);
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .progress {
            height: 100%;
            background: var(--theme);
            border-radius: 5px;
            width: 0;
        }

        .buttons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        button {
            background: none;
            border: none;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
        }

        .file-label {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 25px;
            background: var(--theme);
            color: #000;
            border-radius: 25px;
            cursor: pointer;
        }

        .builtin-video {
            margin-top: 20px;
            max-width: 600px;
        }

        .builtin-video video {
            cursor: pointer;
            border-radius: 10px;
        }
    </style>
</head>

<body>

    <!-- ===== 侧边栏 ===== -->
    <!-- 1. 把按钮挪到 sidebar 外面 -->
    <button id="toggleDir" title="折叠/展开目录">≡</button>

    <aside id="sidebar">
        <!-- 这里只留下 ul 和 dropZone，不要再放按钮 -->
        <ul id="videoList"></ul>
        <div id="dropZone">拖拽视频文件至此<br>或点击<input type="file" id="multiFile" multiple accept="video/*" style="display:none"> <label for="multiFile" style="color:var(--theme);cursor:pointer">选择多个文件</label></div>
    </aside>

    <!-- ===== 主内容 ===== -->
    <main id="main">
        <h1>本地视频目录播放器</h1>

        <!-- 主播放器 -->
        <div class="video-container">
            <video id="mainVideo" preload="metadata"></video>
            <div class="controls">
                <div class="progress-bar" onclick="seekVideo(event)">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="buttons">
                    <button onclick="togglePlay()">▶️</button>
                    <button onclick="skip(-10)">⏪ 10s</button>
                    <button onclick="skip(10)">⏩ 10s</button>
                    <button onclick="toggleMute()" id="muteBtn">🔊</button>
                    <input type="range" id="volumeSlider" min="0" max="1" step="0.05" value="1" style="width:80px">
                    <button onclick="toggleFullscreen()">⛶</button>
                </div>
            </div>
        </div>

        <!-- 示例视频（可选，想关掉就删） -->
        <div class="builtin-video">
            <video id="builtinVideo" muted loop width="100%">
                <source src="sample.mp4" type="video/mp4">
                示例视频加载失败
            </video>
            <p style="color:#888;font-size:14px;margin-top:5px">点击上方示例视频可播放/暂停</p>
        </div>
    </main>

    <script>
        /* ========== 通用函数 ========== */
        const $ = sel => document.querySelector(sel);
        const mainVideo = $('#mainVideo');
        const listEl = $('#videoList');
        const dropZone = $('#dropZone');
        const multiFile = $('#multiFile');
        const builtinVideo = $('#builtinVideo');
        const progress = $('#progress');
        const volumeSlider = $('#volumeSlider');
        let playlist = [];

        /* ========== 目录切换按钮 ========== */
        $('#toggleDir').onclick = () => $('#sidebar').classList.toggle('collapsed');

        /* ========== 目录侧边栏按钮 ========== */
        toggleDir.onclick = () => {
            sidebar.classList.toggle('collapsed');
            toggleDir.textContent = sidebar.classList.contains('collapsed') ? '▶' : '≡';
        };

        /* ========== 添加视频到列表 ========== */
        function addToPlaylist(file) {
            playlist.push(file);
            const li = document.createElement('li');
            li.textContent = file.name || decodeURIComponent(file.split('/').pop());
            li.onclick = () => loadVideo(file, li);
            listEl.appendChild(li);
        }

        /* ========== 加载并播放 ========== */
        function loadVideo(source, activeLi) {
            [...listEl.children].forEach(li => li.classList.remove('active'));
            if (activeLi) activeLi.classList.add('active');

            if (typeof source === 'string') {          // 来自服务器
                mainVideo.src = source;
            } else {                                   // 来自本地 File 对象
                mainVideo.src = URL.createObjectURL(source);
            }
            mainVideo.load();
            mainVideo.play().catch(() => { });
        }

        /* ========== 进度条 & 控制 ========== */
        mainVideo.addEventListener('timeupdate', () => {
            progress.style.width = (mainVideo.currentTime / mainVideo.duration * 100 || 0) + '%';
        });
        function seekVideo(e) {
            const pct = (e.offsetX / e.currentTarget.offsetWidth);
            mainVideo.currentTime = pct * mainVideo.duration;
        }
        function togglePlay() {
            mainVideo.paused ? mainVideo.play() : mainVideo.pause();
        }
        function skip(sec) { mainVideo.currentTime += sec; }
        function toggleMute() {
            mainVideo.muted = !mainVideo.muted;
            $('#muteBtn').textContent = mainVideo.muted ? '🔇' : '🔊';
        }
        function toggleFullscreen() {
            mainVideo.requestFullscreen?.();
        }
        volumeSlider.oninput = () => { mainVideo.volume = volumeSlider.value; };

        /* ========== 本地多文件选择 ========== */
        multiFile.onchange = e => {
            [...e.target.files].forEach(addToPlaylist);
        };

        /* ========== 拖拽添加 ========== */
        ['dragenter', 'dragover'].forEach(evt => dropZone.addEventListener(evt, e => {
            e.preventDefault(); dropZone.classList.add('dragover');
        }));
        ['dragleave', 'drop'].forEach(evt => dropZone.addEventListener(evt, e => {
            if (e.type === 'drop') e.preventDefault();
            dropZone.classList.remove('dragover');
        }));
        dropZone.addEventListener('drop', e => {
            [...e.dataTransfer.files].filter(f => f.type.startsWith('video/')).forEach(addToPlaylist);
        });

        /* ========== 自动扫描 videos 文件夹（需要本地服务器） ========== ========== */
        /*  若你使用 VS Code Live Server / Python http.server / Nginx 等，
            只要在 videos 目录里放 mp4，就可以自动列目录。
            如果直接双击 HTML 文件（file:// 协议）则没有服务器，会跳过这一段。 */
        fetch('videos/')
            .then(r => r.text())
            .then(text => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                [...doc.querySelectorAll('a')].forEach(a => {
                    const href = a.getAttribute('href');
                    if (/\.(mp4|webm|ogg|mov)$/i.test(href)) {
                        addToPlaylist('videos/' + href);
                    }
                });
            })
            .catch(() => { });   // 没服务器也不报错

        /* ========== 示例视频点击播放 ========== */
        builtinVideo.onclick = () => builtinVideo.paused ? builtinVideo.play() : builtinVideo.pause();
    </script>
</body>

</html>