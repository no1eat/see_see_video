<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>æœ¬åœ°è§†é¢‘ç›®å½•æ’­æ”¾å™¨</title>
    <style>
        :root {
            --theme: #00d4aa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* ===== ä¾§è¾¹æ  ===== */
        #sidebar {
            width: 260px;
            flex-shrink: 0;
            background: #222;
            display: flex;
            flex-direction: column;
            transition: width .3s;
            overflow: hidden;
        }

        #sidebar.collapsed {
            width: 0;
        }

        /* 2. è®©æŒ‰é’®å›ºå®šåœ¨å±å¹•å·¦ä¾§ï¼Œå§‹ç»ˆå¯è§ */
        #toggleDir {
            position: fixed;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            z-index: 999;
            background: #111;
            color: var(--theme);
            border: none;
            padding: 8px;
            font-size: 20px;
            cursor: pointer;
            border-radius: 0 8px 8px 0;
        }

        /* 3. å½“ sidebar æŠ˜å æ—¶ï¼ŒæŠŠæŒ‰é’®ç¨å¾®å¾€å³æ¨ï¼Œé¿å…é‡å  */
        #sidebar.collapsed+#toggleDir {
            left: 0;
        }

        #videoList {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            list-style: none;
        }

        #videoList li {
            padding: 8px 6px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #videoList li:hover {
            background: #333;
        }

        #videoList li.active {
            background: var(--theme);
            color: #000;
        }

        #dropZone {
            border: 2px dashed #555;
            margin: 10px;
            padding: 20px;
            text-align: center;
            color: #888;
            border-radius: 6px;
        }

        #dropZone.dragover {
            border-color: var(--theme);
            color: var(--theme);
        }

        /* ===== ä¸»å†…å®¹ ===== */
        #main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        h1 {
            margin-bottom: 20px;
        }

        .video-container {
            position: relative;
            max-width: 900px;
            width: 100%;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
        }

        video {
            width: 100%;
            display: block;
        }

        .controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, #000, transparent);
            padding: 15px;
            opacity: 0;
            transition: opacity .3s;
        }

        .video-container:hover .controls {
            opacity: 1;
        }

        .progress-bar {
            width: 100%;
            height: 5px;
            background: rgba(255, 255, 255, .3);
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .progress {
            height: 100%;
            background: var(--theme);
            border-radius: 5px;
            width: 0;
        }

        .buttons {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        button {
            background: none;
            border: none;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
        }

        .file-label {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 25px;
            background: var(--theme);
            color: #000;
            border-radius: 25px;
            cursor: pointer;
        }

        .builtin-video {
            margin-top: 20px;
            max-width: 600px;
        }

        .builtin-video video {
            cursor: pointer;
            border-radius: 10px;
        }
    </style>
</head>

<body>

    <!-- ===== ä¾§è¾¹æ  ===== -->
    <!-- 1. æŠŠæŒ‰é’®æŒªåˆ° sidebar å¤–é¢ -->
    <button id="toggleDir" title="æŠ˜å /å±•å¼€ç›®å½•">â‰¡</button>

    <aside id="sidebar">
        <!-- è¿™é‡Œåªç•™ä¸‹ ul å’Œ dropZoneï¼Œä¸è¦å†æ”¾æŒ‰é’® -->
        <ul id="videoList"></ul>
        <div id="dropZone">æ‹–æ‹½è§†é¢‘æ–‡ä»¶è‡³æ­¤<br>æˆ–ç‚¹å‡»<input type="file" id="multiFile" multiple accept="video/*" style="display:none"> <label for="multiFile" style="color:var(--theme);cursor:pointer">é€‰æ‹©å¤šä¸ªæ–‡ä»¶</label></div>
    </aside>

    <!-- ===== ä¸»å†…å®¹ ===== -->
    <main id="main">
        <h1>æœ¬åœ°è§†é¢‘ç›®å½•æ’­æ”¾å™¨</h1>

        <!-- ä¸»æ’­æ”¾å™¨ -->
        <div class="video-container">
            <video id="mainVideo" preload="metadata"></video>
            <div class="controls">
                <div class="progress-bar" onclick="seekVideo(event)">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="buttons">
                    <button onclick="togglePlay()">â–¶ï¸</button>
                    <button onclick="skip(-10)">âª 10s</button>
                    <button onclick="skip(10)">â© 10s</button>
                    <button onclick="toggleMute()" id="muteBtn">ğŸ”Š</button>
                    <input type="range" id="volumeSlider" min="0" max="1" step="0.05" value="1" style="width:80px">
                    <button onclick="toggleFullscreen()">â›¶</button>
                </div>
            </div>
        </div>

        <!-- ç¤ºä¾‹è§†é¢‘ï¼ˆå¯é€‰ï¼Œæƒ³å…³æ‰å°±åˆ ï¼‰ -->
        <div class="builtin-video">
            <video id="builtinVideo" muted loop width="100%">
                <source src="sample.mp4" type="video/mp4">
                ç¤ºä¾‹è§†é¢‘åŠ è½½å¤±è´¥
            </video>
            <p style="color:#888;font-size:14px;margin-top:5px">ç‚¹å‡»ä¸Šæ–¹ç¤ºä¾‹è§†é¢‘å¯æ’­æ”¾/æš‚åœ</p>
        </div>
    </main>

    <script>
        /* ========== é€šç”¨å‡½æ•° ========== */
        const $ = sel => document.querySelector(sel);
        const mainVideo = $('#mainVideo');
        const listEl = $('#videoList');
        const dropZone = $('#dropZone');
        const multiFile = $('#multiFile');
        const builtinVideo = $('#builtinVideo');
        const progress = $('#progress');
        const volumeSlider = $('#volumeSlider');
        let playlist = [];

        /* ========== ç›®å½•åˆ‡æ¢æŒ‰é’® ========== */
        $('#toggleDir').onclick = () => $('#sidebar').classList.toggle('collapsed');

        /* ========== ç›®å½•ä¾§è¾¹æ æŒ‰é’® ========== */
        toggleDir.onclick = () => {
            sidebar.classList.toggle('collapsed');
            toggleDir.textContent = sidebar.classList.contains('collapsed') ? 'â–¶' : 'â‰¡';
        };

        /* ========== æ·»åŠ è§†é¢‘åˆ°åˆ—è¡¨ ========== */
        function addToPlaylist(file) {
            playlist.push(file);
            const li = document.createElement('li');
            li.textContent = file.name || decodeURIComponent(file.split('/').pop());
            li.onclick = () => loadVideo(file, li);
            listEl.appendChild(li);
        }

        /* ========== åŠ è½½å¹¶æ’­æ”¾ ========== */
        function loadVideo(source, activeLi) {
            [...listEl.children].forEach(li => li.classList.remove('active'));
            if (activeLi) activeLi.classList.add('active');

            if (typeof source === 'string') {          // æ¥è‡ªæœåŠ¡å™¨
                mainVideo.src = source;
            } else {                                   // æ¥è‡ªæœ¬åœ° File å¯¹è±¡
                mainVideo.src = URL.createObjectURL(source);
            }
            mainVideo.load();
            mainVideo.play().catch(() => { });
        }

        /* ========== è¿›åº¦æ¡ & æ§åˆ¶ ========== */
        mainVideo.addEventListener('timeupdate', () => {
            progress.style.width = (mainVideo.currentTime / mainVideo.duration * 100 || 0) + '%';
        });
        function seekVideo(e) {
            const pct = (e.offsetX / e.currentTarget.offsetWidth);
            mainVideo.currentTime = pct * mainVideo.duration;
        }
        function togglePlay() {
            mainVideo.paused ? mainVideo.play() : mainVideo.pause();
        }
        function skip(sec) { mainVideo.currentTime += sec; }
        function toggleMute() {
            mainVideo.muted = !mainVideo.muted;
            $('#muteBtn').textContent = mainVideo.muted ? 'ğŸ”‡' : 'ğŸ”Š';
        }
        function toggleFullscreen() {
            mainVideo.requestFullscreen?.();
        }
        volumeSlider.oninput = () => { mainVideo.volume = volumeSlider.value; };

        /* ========== æœ¬åœ°å¤šæ–‡ä»¶é€‰æ‹© ========== */
        multiFile.onchange = e => {
            [...e.target.files].forEach(addToPlaylist);
        };

        /* ========== æ‹–æ‹½æ·»åŠ  ========== */
        ['dragenter', 'dragover'].forEach(evt => dropZone.addEventListener(evt, e => {
            e.preventDefault(); dropZone.classList.add('dragover');
        }));
        ['dragleave', 'drop'].forEach(evt => dropZone.addEventListener(evt, e => {
            if (e.type === 'drop') e.preventDefault();
            dropZone.classList.remove('dragover');
        }));
        dropZone.addEventListener('drop', e => {
            [...e.dataTransfer.files].filter(f => f.type.startsWith('video/')).forEach(addToPlaylist);
        });

        /* ========== è‡ªåŠ¨æ‰«æ videos æ–‡ä»¶å¤¹ï¼ˆéœ€è¦æœ¬åœ°æœåŠ¡å™¨ï¼‰ ========== ========== */
        /*  è‹¥ä½ ä½¿ç”¨ VS Code Live Server / Python http.server / Nginx ç­‰ï¼Œ
            åªè¦åœ¨ videos ç›®å½•é‡Œæ”¾ mp4ï¼Œå°±å¯ä»¥è‡ªåŠ¨åˆ—ç›®å½•ã€‚
            å¦‚æœç›´æ¥åŒå‡» HTML æ–‡ä»¶ï¼ˆfile:// åè®®ï¼‰åˆ™æ²¡æœ‰æœåŠ¡å™¨ï¼Œä¼šè·³è¿‡è¿™ä¸€æ®µã€‚ */
        fetch('videos/')
            .then(r => r.text())
            .then(text => {
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');
                [...doc.querySelectorAll('a')].forEach(a => {
                    const href = a.getAttribute('href');
                    if (/\.(mp4|webm|ogg|mov)$/i.test(href)) {
                        addToPlaylist('videos/' + href);
                    }
                });
            })
            .catch(() => { });   // æ²¡æœåŠ¡å™¨ä¹Ÿä¸æŠ¥é”™

        /* ========== ç¤ºä¾‹è§†é¢‘ç‚¹å‡»æ’­æ”¾ ========== */
        builtinVideo.onclick = () => builtinVideo.paused ? builtinVideo.play() : builtinVideo.pause();
    </script>
</body>

</html>